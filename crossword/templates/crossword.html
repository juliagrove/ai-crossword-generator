<div class="crossword-container">
    {% if error_message %}
        <div class="alert">
            Failed to Generate Crossword
            <div class= "dev-error-message">
                Dev: {{ error_message }}
            </div>
        </div>
    {% else %}
        <!-- List of Clues -->
        <div class="wordList">
            <div class="across-clues">
                <h3>ACROSS</h3>
                <ul>
                    {% for clue in across_clues %}
                        <li><strong>{{ clue.number }}.</strong> {{ clue.clue }}</li>
                    {% endfor %}
                </ul>
            </div>
            <div class="down-clues">
                <h3>DOWN</h3>
                <ul>
                    {% for clue in down_clues %}
                        <li><strong>{{ clue.number }}.</strong> {{ clue.clue }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <!-- Crossword Grid -->
        <div class="grid">
            <table class="crossword-table">
            {% for row in crossword_grid %}
                <tr>
                {% for cell in row %}
                    <td class="{% if cell == '-' %}black-square{% else %}white-square{% endif %}">
                    {% if cell != '-' %}
                        <div class="cell">
                        {% if cell|length > 1 %}
                            <span class="corner-number">{{ cell|slice:':-1' }}</span>
                        {% endif %}
                        <input
                            type="text"
                            maxlength="1"
                            class="crossword-input"
                            data-answer="{{ cell|slice:'-1:' }}" 
                        />
                        </div>
                    {% endif %}
                    </td>
                {% endfor %}
                </tr>
            {% endfor %}
            </table>
        </div>
        <!-- Toggle for showing correct/incorrect cells  -->
        <label class="toggle-container">
            <label class="switch">
            <input type="checkbox" id="errorToggle" checked>
            <span class="slider">AUTO CHECK</span>
            </label>
        </label>

        <!-- JavaScript logic -->
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const inputs = document.querySelectorAll(".crossword-input");
                const toggle = document.getElementById("errorToggle");
                let errorTracking = toggle.checked;

                function checkAllInputs() {
                    inputs.forEach(input => {
                        const correct = input.dataset.answer.toUpperCase();
                        const userVal = input.value.toUpperCase();
                
                        if (userVal === "") {
                            input.style.color = "black";
                            input.style.fontWeight = "normal";
                        } else if (userVal === correct) {
                            input.style.color = "black";
                            input.style.fontWeight = "bold";
                        } else {
                            input.style.color = "red";
                            input.style.fontWeight = "bold";
                        }
                    });
                }
            
                // Toggle on/off error tracking
                toggle.addEventListener("change", () => {
                    errorTracking = toggle.checked;
                    if (errorTracking) {
                        checkAllInputs();
                    } else {
                        inputs.forEach(input => {
                            input.style.color = "black";
                            input.style.fontWeight = "bold";
                        });
                    }
                });
            
                // Recheck individual inputs when typed
                inputs.forEach(input => {
                    input.addEventListener("input", () => {
                        const correct = input.dataset.answer.toUpperCase();
                        const userVal = input.value.toUpperCase();
                
                        if (!errorTracking) return;
                
                        if (userVal === "") {
                            input.style.color = "black";
                            input.style.fontWeight = "normal";
                        } else if (userVal === correct) {
                            input.style.color = "black";
                            input.style.fontWeight = "bold";
                        } else {
                            input.style.color = "red";
                            input.style.fontWeight = "bold";
                        }
                    });
                });
            });
        </script>          
    {% endif %}  
</div>
